function init(){$("body").fitVids(),$(".category-list").ntm(),$(".selectpicker").selectpicker({container:"body",iconBase:"fa",tickIcon:"fa-check-square-o"}),$("body").tooltip({selector:'[data-toggle="tooltip"]'}),initAdd(),initMenu(),initUser(),initSort(),initForm(),initLogin(),initSlider(),initFooter(),initSearch(),initRegister(),initLightbox(),initJustified(),initSubscribe(),initNewPassword(),initLostPassword(),initShareButtons(),initEntryRating(),initBookmark(),initComments(),$(".slide-content").dotdotdot(),$(".gallery-content").dotdotdot(),$("time").html(function(){return moment($(this).attr("datetime"),"YYYY-MM-DDTHH:mm:ss").fromNow()}),$(document).on("click",".notice-page-last .close",function(){$(this).closest(".notice-page-last").addClass("hidden")})}function initSearch(){document.location.href.indexOf("search")>0&&$(".entry-content").highlight($(".search-input-list").val()),$(".search-input").autocomplete({serviceUrl:"/ajax",minChars:3,type:"POST",paramName:"search",params:{action:"search"},onSelect:function(t,e){window.location.href=t.data}})}function initSort(){$(document).on("click",".sort-select li",function(){var t=$(".sort-select li");$.post("/ajax",{sort:$(this).data("sort"),action:"update-sort"},function(e){"string"==$.type(e)&&(t.each(function(){$(this).data("sort")==e?$(this).addClass("active"):$(this).removeClass("active")}),location.reload())})})}function initAdd(){editorInit(),$(".token-field").tokenfield(),$(".translit-in").on("input",function(){$(this).liTranslit({elAlias:$(".translit-out")})}),$(".input-in").change(function(){$(".input-out").val($(this).val())}),$("#content-add-form").bootstrapValidator({excluded:[":disabled"],fields:{url:{validators:{notEmpty:{message:"Cannot be empty"},remote:{message:"This URL is already in use",data:{action:"check-free-url"},url:"/ajax",type:"POST",delay:0}}},title:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{max:255,message:"255 characters maximum"}}},header:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{max:255,message:"255 characters maximum"}}},shortentry:{validators:{notEmpty:{message:"Cannot be empty"}}},fullentry:{validators:{notEmpty:{message:"Cannot be empty"}}},description:{validators:{stringLength:{max:160,message:"255 characters maximum"}}},captcha:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{min:5,max:5,message:"Must contain 5 characters"},remote:{message:"Invalid security code",data:{action:"check-captcha"},url:"/ajax",type:"POST",delay:0}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,$.post("/ajax",$(t.target).serialize()+"&action=add-content",function(e){"ok"==e?$(".notice-success").removeClass("hidden"):$(".notice-danger").removeClass("hidden"),$(t.target).bootstrapValidator("resetForm",!0),$(t.target).find("img").attr("src","/captcha"),$(t.target).find("option").removeAttr("selected"),$(t.target).find(".editor-content").each(function(){$(this).summernote("reset")}),$(".token-field").tokenfield("setTokens",[]),$(".selectpicker").selectpicker("refresh")})})}function initFooter(){var t=$("#footer");t.hasClass("footer-fixed")&&$("#main-wrap").css("margin-bottom",t.outerHeight())}function initSlider(){$(".feature-slider").slick({autoplay:!0})}function initJustified(){var t=$(".entry-justified");t.length&&t.each(function(){var t=$(this).data("height");$(this).justifiedGallery({rowHeight:t,captions:!1,margins:5})})}function initLightbox(){$(document).on("click",".gallery-overlay",function(){$(this).siblings("a").click()}),$(".lightbox").magnificPopup({type:"image",mainClass:"mfp-with-zoom",gallery:{enabled:!0},zoom:{enabled:!0}})}function initMenu(){var t=$(".site-bar .navigation"),e=$("#mobile-menu");t.clone().removeAttr("id").removeClass().appendTo(e),e.find("li").removeAttr("id"),e.mmenu({offCanvas:{position:"top",zposition:"front"},autoHeight:!0,navbars:[{position:"top",content:["prev","title","close"]}],extensions:["theme-black"]}),t.superfish({delay:300,animation:{opacity:"show",height:"show"},speed:"fast",dropShadows:!1})}function initLogin(){$("#login-form").bootstrapValidator({fields:{login:{validators:{notEmpty:{message:"Cannot be empty"}}},password:{validators:{notEmpty:{message:"Cannot be empty"}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,$.post("/ajax",$(t.target).serialize()+"&action=login",function(e){"ok"==e?window.location.href="/":$(".notice-default").removeClass("hidden"),$(t.target).bootstrapValidator("resetForm",!0)})})}function initRegister(){$("#register-form").bootstrapValidator({fields:{login:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{max:255,message:"255 characters maximum"},remote:{message:"This login is already in use",data:{action:"check-free-login"},url:"/ajax",type:"POST",delay:0}}},name:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{max:255,message:"255 characters maximum"}}},email:{validators:{notEmpty:{message:"Cannot be empty"},emailAddress:{message:"Please enter a valid email address"},remote:{message:"This email is already in use",data:{action:"check-free-email"},url:"/ajax",type:"POST",delay:0}}},captcha:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{min:5,max:5,message:"Must contain 5 characters"},remote:{message:"Invalid security code",data:{action:"check-captcha"},url:"/ajax",type:"POST",delay:0}}},password:{validators:{notEmpty:{message:"Cannot be empty"},identical:{field:"password",message:"Password mismatch"},stringLength:{min:6,message:"6 characters minimum"}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,$.post("/ajax",$(t.target).serialize()+"&action=add-user",function(t){"ok"==t?window.location.href="/":$(".notice-default").removeClass("hidden")})})}function initLostPassword(){$("#lost-password-form").bootstrapValidator({fields:{lostname:{validators:{notEmpty:{message:"Cannot be empty"}}},captcha:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{min:5,max:5,message:"Must contain 5 characters"},remote:{message:"Invalid security code",data:{action:"check-captcha"},url:"/ajax",type:"POST",delay:0}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,$.post("/ajax",$(t.target).serialize()+"&action=lost-password",function(e){"ok"==e?($(".notice-success").removeClass("hidden"),$(".notice-danger").addClass("hidden")):($(".notice-success").addClass("hidden"),$(".notice-danger").removeClass("hidden")),$(t.target).bootstrapValidator("resetForm",!0),$(t.target).find("img").attr("src","/captcha")})})}function initNewPassword(){$("#new-password-form").bootstrapValidator({fields:{password:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{min:6,message:"6 characters minimum"}}},confirm:{validators:{notEmpty:{message:"Cannot be empty"},identical:{field:"password",message:"Password mismatch"}}},captcha:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{min:5,max:5,message:"Must contain 5 characters"},remote:{message:"Invalid security code",data:{action:"check-captcha"},url:"/ajax",type:"POST",delay:0}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,$.post("/ajax",$(t.target).serialize()+"&action=update-password",function(e){"ok"==e?window.location.href="/":$(".notice-danger").removeClass("hidden"),$(t.target).bootstrapValidator("resetForm",!0),$(t.target).find("img").attr("src","/captcha")})})}function initUser(){var t=$("#user-edit-form");t.bootstrapValidator({fields:{login:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{max:255,message:"255 characters maximum"},remote:{message:"Такой логин уже используется",data:{action:"check-free-login",id:t.data("id")},url:"/admin/users/ajax",type:"POST",delay:0}}},name:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{max:255,message:"255 characters maximum"}}},email:{validators:{notEmpty:{message:"Cannot be empty"},emailAddress:{message:"Please enter a valid email address"},remote:{message:"This email is already in use",data:{action:"check-free-email",id:t.data("id")},url:"/ajax",type:"POST",delay:0}}},"current-password":{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{min:6,message:"6 characters minimum"}}},"new-password":{validators:{stringLength:{min:6,message:"6 characters minimum"}}},"confirm-password":{validators:{identical:{field:"new-password",message:"Password mismatch"}}},captcha:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{min:5,max:5,message:"Must contain 5 characters"},remote:{message:"Invalid security code",data:{action:"check-captcha"},url:"/ajax",type:"POST",delay:0}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,$.post("/ajax",$(t.target).serialize()+"&action=update-user",function(e){"ok"==e?($(".notice-success").removeClass("hidden"),$(".notice-warning").addClass("hidden"),$(".notice-danger").addClass("hidden")):"wrong-password"==e?($(".notice-success").addClass("hidden"),$(".notice-warning").removeClass("hidden"),$(".notice-danger").addClass("hidden")):($(".notice-success").addClass("hidden"),$(".notice-warning").addClass("hidden"),$(".notice-danger").removeClass("hidden")),$(t.target).bootstrapValidator("resetForm","",!1),$(t.target).bootstrapValidator("resetField","current-password",!0),$(t.target).bootstrapValidator("resetField","new-password",!0),$(t.target).bootstrapValidator("resetField","confirm-password",!0)})})}function initComments(){var t=$("input[name=reply]");$(document).on("click",".comment-reply",function(){var e=$(this).closest(".comment-item"),a=$(".notice-reply-comment");a.find(".comment-reply-author").text("Ответ для: "+e.find(".comment-author").first().text()),a.find(".comment-reply-message").text(e.find(".comment-message").first().text()),a.find("a").attr("href","#"+e.attr("id")),a.removeClass("hidden"),$("body").animate({scrollTop:a.offset().top-60},1e3),t.val(e.attr("id").split("-")[1])}),$(document).on("click",".notice-reply-comment .to-quote",function(){$("body").animate({scrollTop:$("#comment-"+t.val()).offset().top-60},1e3)}),$(document).on("click",".notice-reply-comment .close",function(){$(this).closest(".notice-reply-comment").addClass("hidden"),t.val("")}),$(document).on("click",".notice-add-comment .close",function(){$(this).closest(".notice-add-comment").addClass("hidden")}),$("#comment-form-add").bootstrapValidator({fields:{name:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{max:255,message:"255 characters maximum"}}},email:{validators:{notEmpty:{message:"Cannot be empty"},emailAddress:{message:"Please enter a valid email address"}}},comment:{validators:{notEmpty:{message:"Cannot be empty"}}},captcha:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{min:5,max:5,message:"Must contain 5 characters"},remote:{message:"Invalid security code",data:{action:"check-captcha"},url:"/ajax",type:"POST",delay:0}}}}}).on("success.form.bv",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,$.post("/ajax",$(e.target).serialize()+"&action=add-comment",function(a){"no-moderation"==a?(t.val()>0&&$("body").animate({scrollTop:$("#comment-"+t.val()).offset().top-60},1e3),$("#comments").load(document.location.href+" #comments-section",function(){init()})):"moderation"==a?$(".notice-add-comment").removeClass("hidden"):$(".notice-danger").removeClass("hidden"),$(e.target).bootstrapValidator("resetForm",!0),$(e.target).find("img").attr("src","/captcha"),$(".notice-reply-comment").addClass("hidden"),t.val("")})})}function initForm(){$(".page-form").each(function(){$(this).bootstrapValidator({fields:{captcha:{validators:{notEmpty:{message:"Cannot be empty"},stringLength:{min:5,max:5,message:"Must contain 5 characters"},remote:{message:"Invalid security code",data:{action:"check-captcha"},url:"/ajax",type:"POST",delay:0}}}}}).on("success.form.bv",function(t){var e,a;t.preventDefault?t.preventDefault():t.returnValue=!1,$.post("/ajax",{action:"add-formdata",json:(e=$(this),a=[],e.find(".form-component").each(function(){switch($(this).data("type")){case"text":a.push({type:"text",name:$(this).find("label").text(),value:$(this).find(":input").val()});break;case"textarea":a.push({type:"textarea",name:$(this).find("label").text(),value:$(this).find(":input").val()});break;case"select":var t=$(this).find("label").text(),e=[];$(this).find(":input :checked").each(function(){e.push($(this).text())}),a.push({type:"select",name:t,value:e.length>0?e:"ничего не выбрано"});break;case"radio":a.push({type:"radio",name:$(this).find(".control-label").text(),value:$(this).find(":input").filter(":checked").parent().text().replace(/[\r\n]/g,"").trim()});break;case"checkbox":a.push({type:"checkbox",name:$(this).find("label").text().trim(),value:$(this).find(":input").is(":checked")?"отмечено":"не отмечено"})}}),function(t){return t.replace(/\\n/g,"\\n").replace(/[\\]/g,"\\\\").replace(/[\/]/g,"\\/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")}(JSON.stringify(a))),page:$(".page-title").text(),captcha:$("#captcha").val()},function(e){"ok"==e?($(".notice-success").removeClass("hidden"),$(".notice-danger").addClass("hidden")):($(".notice-success").addClass("hidden"),$(".notice-danger").removeClass("hidden")),$(t.target).bootstrapValidator("resetForm",!0),$(t.target).find("img").attr("src","/captcha")})})})}function initBookmark(){var t=$(".bookmark-link"),e=t.html();$.post("/ajax",{action:"get-bookmark-count"},function(a){t.html(e+" ("+a+")")}),$(document).on("click",".entry-bookmark",function(){var a=$(this),n=a.closest(".entry-item").attr("id").split("-")[2];$.post("/ajax",{action:"update-bookmark",id:n},function(n){a.hasClass("entry-action-active")?a.removeClass("entry-action-active"):a.addClass("entry-action-active"),t.html(e+" ("+n+")")})})}function initEntryRating(){$(document).on("click",".entry-rating",function(){if(!$(this).hasClass("entry-action-active")){var t=$(this),e=t.closest(".entry-item").attr("id").split("-")[2];$.post("/ajax",{action:"update-rating",id:e},function(e){t.find(".rating").text(e),t.addClass("entry-action-active")})}})}function initSubscribe(){$("#subscribe-form").bootstrapValidator({fields:{"subscribe-email":{validators:{notEmpty:{message:"Cannot be empty"},emailAddress:{message:"Please enter a valid email address"}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,$.post("/ajax",$(t.target).serialize()+"&action=add-delivery-email",function(e){"already signed"==e?bootbox.alert("You are already subscribed to the newsletter!"):"ok"==e?bootbox.alert("Subscription to the newsletter is issued!"):bootbox.alert("An unknown error has occurred!"),$(t.target).trigger("reset")})})}function initShareButtons(){$(document).on("click",".social-share i",function(){var t,e=$('meta[name="description"]').attr("content"),a=encodeURIComponent(document.location.href);switch($(this).attr("class")){case"fa fa-facebook":t="http://www.facebook.com/sharer.php?s=100&p[summary]="+e+"&p[url]="+a;break;case"fa fa-vk":t="http://vkontakte.ru/share.php?url="+a+"&description="+e+"&noparse=true";break;case"fa fa-odnoklassniki":t="http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st.comments="+e+"&st._surl="+a;break;case"fa fa-google-plus":t="https://plus.google.com/share?url="+a;break;case"fa fa-twitter":t="http://twitter.com/share?text="+e+"&url="+a}/^(http|https):\/\/([^\/:]+)(:\d*)?([^# ]*)/.test(t)&&window.open(t,"displayWindow","width=500, height=400, left=200, top=100, location=no, directories=no, status=no, toolbar=no, menubar=no")})}function editorInit(){$.getScript("/admin/public/js/summernote.min.js",function(){$(".editor-content").each(function(t,e){$(e).summernote({toolbar:[["font",["bold","underline","strikethrough","clear"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["link"]],["height",["height"]]],callbacks:{onChange:function(){$(e).data("bv-field")&&$(e).closest("form").data("bootstrapValidator").updateStatus($(e).attr("name"),"NOT_VALIDATED",null).validateField($(e).attr("name"))}},height:400})})})}