function messagesActionHandler(){document.location.href.indexOf("messages")<0||($(".message-add").on("click",function(){messageAdd()}),$(".btn-messages-checkbox").on("click",function(){messagesCheckboxHandler()}),$(".messages-action div").on("click",function(){var e=$(this).closest(".messages-list").attr("id").split("-")[1];switch($(this).attr("class")){case"messages-view":messageView(e);break;case"messages-delete":messagesDelete(e)}}),$(".messages-view-list").on("click",function(){$(this).closest("tr").find(".messages-view").click()}),messagesTableSortable())}function messagesTableSortable(){var e=[];$(".table-messages-body").sortable({appendTo:"parent",handle:".fa-bars",start:function(s,a){$(this).children().each(function(){$(this).hasClass("ui-sortable-placeholder")||e.push($(this).attr("id").split("-")[2])})},update:function(s,a){var t=[],o=[];$(this).children().each(function(){$(this).hasClass("ui-sortable-placeholder")||t.push($(this).attr("id").split("-")[1])}),$.each(t,function(s,a){o.push({id:[a],position:e[s]})}),o=JSON.stringify(o),$.post("/admin/messages/ajax",{action:"update-position",json:o},function(e){"ok"==e?$.toast({text:"Change saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"})})}}).disableSelection()}function messagesCheckboxHandler(){var e=$("#list-messages-form").serialize();e.indexOf("select-action=delete")+1&&(e+="&action=delete"),e.indexOf("id")+1?bootbox.dialog({message:"Perform selected action?",buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/messages/ajax",e,function(e){"ok"==e?$.toast({text:"Changes saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}}):bootbox.alert("You have not chosen anything!")}function messageAdd(){$.post("/admin/messages/ajax",{action:"get-form-add"},function(e){bootbox.dialog({title:"A new message",message:e,className:"big-modal",buttons:{success:{label:"Submit",className:"btn-success",callback:function(){return $("#message-form-add").submit(),!1}},danger:{label:"Cancel",className:"btn-danger",callback:function(){}}}}),$(".selectpicker").selectpicker({container:".big-modal",iconBase:"fa",tickIcon:"fa-check-square-o"}),$("#message-form-add").bootstrapValidator({excluded:[":disabled"],fields:{subject:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"}}},message:{validators:{notEmpty:{message:"Cannot be empty."}}}}}).on("success.form.bv",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var s=$.param({action:"add"});$.post("/admin/messages/ajax",$(e.target).serialize()+"&"+s,function(e){"ok"==e?(bootbox.hideAll(),$.toast({text:"Message sent!",icon:"success"})):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})})})}function messageView(e){$.post("/admin/messages/ajax",{action:"get-view",id:e},function(e){bootbox.dialog({title:"View message",message:e,className:"big-modal",buttons:{danger:{label:"Close",className:"btn-info",callback:function(){}}}})})}function messagesDelete(e){bootbox.dialog({message:"Delete selected message?",buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/messages/ajax",{action:"delete","id[]":e},function(e){"ok"==e?$.toast({text:"Messages deleted!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}})}