function commentsActionHandler(){document.location.href.indexOf("comments")<0||($(".comments-list").ntm(),$(".view-location").on("click",function(){$.post("/admin/comments/ajax",{action:"get-view-location",ip:$(this).data("ip")},function(t){bootbox.dialog({title:"Location data",message:t,className:"big-modal",buttons:{success:{label:"Ок",className:"btn-success",callback:function(){}}}})})}),$(".btn-comments-checkbox").on("click",function(){commentsCheckboxHandler()}),$(".comment-action div").on("click",function(){var t=$(this).closest(".comments-list").attr("id").split("-")[1];$(this).closest(".comments-list").data("type");switch($(this).attr("class")){case"comment-edit":commentEdit(t);break;case"comment-update-status-on":commentUpdateStatus(t,0);break;case"comment-update-status-off":commentUpdateStatus(t,1);break;case"comment-delete":commentDelete(t)}}),commentsTableSortable())}function commentsTableSortable(){var t=[];$(".table-comments-body").sortable({appendTo:"parent",handle:".fa-bars",start:function(e,a){$(this).children().each(function(){$(this).hasClass("ui-sortable-placeholder")||t.push($(this).attr("id").split("-")[2])})},update:function(e,a){var o=[],s=[];$(this).children().each(function(){$(this).hasClass("ui-sortable-placeholder")||o.push($(this).attr("id").split("-")[1])}),$.each(o,function(e,a){s.push({id:[a],position:t[e]})}),s=JSON.stringify(s),$.post("/admin/comments/ajax",{action:"update-position",json:s},function(t){"ok"==t?$.toast({text:"Change saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"})})}}).disableSelection()}function commentsCheckboxHandler(){var t=$("#list-comments-form").serialize();t.indexOf("select-action=enable")+1?t+="&action=update&status=1":t.indexOf("select-action=disable")+1?t+="&action=update&status=0":t.indexOf("select-action=delete")+1&&(t+="&action=delete"),t.indexOf("id")+1?bootbox.dialog({message:"Perform selected action?",buttons:{success:{label:"Да",className:"btn-success",callback:function(){$.post("/admin/comments/ajax",t,function(t){"ok"==t?$.toast({text:"Changes saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"Нет",className:"btn-danger",callback:function(){}}}}):bootbox.alert("You have not chosen anything!")}function commentEdit(t){$.post("/admin/comments/ajax",{action:"get-form-edit",id:t},function(e){bootbox.dialog({title:"Comment editing",message:e,className:"big-modal",buttons:{success:{label:"Save",className:"btn-success",callback:function(){return $("#comment-form-edit").submit(),!1}},danger:{label:"Cancel",className:"btn-danger",callback:function(){}}}}),$(".check-box-picker").checkboxpicker(),$("#comment-form-edit").bootstrapValidator({excluded:[":disabled"],fields:{name:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"}}},comment:{validators:{notEmpty:{message:"Cannot be empty."}}}}}).on("success.form.bv",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var a=$.param({action:"update",id:[t]});$.post("/admin/comments/ajax",$(e.target).serialize()+"&"+a,function(t){"ok"==t?(bootbox.hideAll(),$.toast({text:"Changes saved!",icon:"success"})):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})})})}function commentUpdateStatus(t,e){var a="";a=1==e?"Post to website?":"Hide from site?",bootbox.dialog({message:a,buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/comments/ajax",{action:"update",status:e,"id[]":t},function(t){"ok"==t?$.toast({text:"Changes saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}})}function commentDelete(t){bootbox.dialog({message:"Delete comment?",buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/comments/ajax",{action:"delete","id[]":t},function(t){"ok"==t?$.toast({text:"Comment has been deleted!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}})}