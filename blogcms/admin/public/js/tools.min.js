function getLocalStorage(e){if("undefined"!=typeof Storage)return localStorage.getItem(e);window.alert("Use a modern browser to run the script!")}function setLocalStorage(e,t){"undefined"!=typeof Storage?localStorage.setItem(e,t):window.alert("Use a modern browser to run the script!")}function formBuilder(){var e=$(".form-container"),t=$(".form-components .form-required-checkbox")[0].outerHTML,a=$(".form-components .form-choices-container")[0].outerHTML,o=$(".form-components .form-choice-item")[0].outerHTML,i=$(".form-components .delete-component")[0].outerHTML,n=$(".form-components .form-panel");function r(e){var o,r;switch(e){case"text":case"textarea":o=!0,r=!1;break;case"select":case"radio":o=!0,r=!0;break;case"checkbox":o=!0,r=!1}var s=n.clone();return s.attr("data-type",e),s.find("small").html(function(e){var t="";switch(e){case"text":t="Single line text";break;case"textarea":t="Multiline text";break;case"select":t="select";break;case"radio":t="Radio button";break;case"checkbox":t="Checkbox"}return t}(e)),o?s.find(".panel-action").html(t+i):s.find(".panel-action").html(i),r?s.find(".panel-body").html(a):s.find(".panel-body").html(),s[0].outerHTML}function s(e){e.attr("checked","checked")}function l(e){e.parents("li").hasClass("selected")?(e.parents("li").removeClass("selected"),e.removeAttr("checked")):("checkbox"!=e.parents(".field").data("type")&&(e.parents(".form-choices-container").find("li").removeClass("selected"),e.parents(".form-choices-container").find(".toggle-selected").not(e).removeAttr("checked")),e.parents("li").addClass("selected"),e.attr("checked","checked"))}$(".form-add-items li").click(function(){$(r($(this).data("type"))).appendTo(e).slideDown("fast"),e.sortable()}),e.on("click",".delete-component",function(){$(this).closest(".form-component").slideUp("slow",function(){$(this).remove()})}),e.on("click",".toggle-required",function(){s($(this))}),e.on("click",".toggle-selected",function(){l($(this))}),e.on("click",".add-choice",function(){$(this).prev().append(o).slideDown("fast"),$(".form-choices-container ul").sortable()}),function(){if("object"!=typeof e.data("json"))return;var t=e.data("json");$.each(t.fields,function(t,a){e.append(r(a.type)).hide().slideDown("fast");var i=e.find(".field").last();i.find(".field-label").val(a.label),a.required&&s(i.find(".form-required-checkbox")),a.choices&&$.each(a.choices,function(e,t){i.find(".form-choices-container ul").append(o),i.find(".choice-label").last().val(t.label),t.selected&&l(i.find(".toggle-selected").last())})}),$.each(t.params,function(e,t){$("input[name="+e+"]").val(t)}),e.sortable(),$(".form-choices-container ul").sortable()}()}function formBuilderSerialize(){var e={fields:[]};$(".form-container .field").each(function(){if($(this).find(".form-choices-container li").length>=1){var t=[];$(this).find(".form-choices-container li").each(function(){t.push({label:$(this).find(".choice-label").val(),selected:$(this).hasClass("selected")?1:0})})}e.fields.push({label:$(this).find(".field-label").val(),required:$(this).find(".form-required-checkbox").is(":checked")?1:0,type:$(this).data("type"),choices:t})});var t={};return $(".form-param").each(function(){t[$(this).attr("name")]=$(this).val()}),e.params=t,JSON.stringify(e)}function imageUpload(e,t,a){"object"!=typeof a&&(a={progress:".progress-images",preview:".images-preview",template:".image-item-html .col-sm-4",thumbnail:!0,drag:"images-drag-zone",btn:".btn-images-upload"});var o,i=document.getElementById(a.drag),n="draggable"in document.createElement("span");window.FormData;function r(o){var i=new FormData,n=$(a.progress),r=$(a.template),s=$(a.preview),l="";n.removeClass("hidden"),i.append("action",t);for(var c=0;c<o.length;c++)i.append("images[]",o[c]);$.ajax({url:e,type:"post",data:i,dataType:"json",processData:!1,contentType:!1,error:function(){n.addClass("hidden"),$.toast({text:"loading error!",icon:"error"})},success:function(e){n.addClass("hidden"),$.each(e.images,function(e,t){var o=a.thumbnail?"thumbnail/":"";r.find("img").attr("src","/files/images/"+o+t),l+=r[0].outerHTML}),s.prepend(l),""!=e.error&&$.toast({text:e.error,icon:"error"})}})}n?((o=i).ondragover=function(){return!1},o.ondragend=function(){return!1},o.ondrop=function(e){e.preventDefault(),r(e.dataTransfer.files)}):$.toast({text:"Drag and Drop not supported!",icon:"error"}),$(a.btn+" :file").on("change",function(){r(this.files)})}function imagesHandler(){imageUpload("/admin/images/ajax","multiple-upload"),$(".images-preview").sortable(),$(document).on("click",".image-delete",function(){var e=$(this).siblings("img").attr("src").split("/");$.post("/admin/images/ajax",{action:"delete",name:e[e.length-1]},function(e){"ok"==e?$.toast({text:"Image deleted!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"})}),$(this).closest(".image-item").parent().remove()})}function summernoteImageHandler(){$(".editor-images-preview").sortable();var e,t={progress:".editor-progress-images",preview:".editor-images-preview",template:".editor-image-item-html .col-sm-4",drag:"editor-drag-zone",btn:".editor-btn-images-upload"},a=document.getElementById(t.drag),o="draggable"in document.createElement("span");window.FormData;function i(e){var a=new FormData,o=$(t.progress),i=$(t.template),n=$(t.preview),r="";o.removeClass("hidden"),a.append("action","images-upload");for(var s=0;s<e.length;s++)a.append("images[]",e[s]);$.ajax({url:"/admin/summernote/ajax",type:"post",data:a,dataType:"json",processData:!1,contentType:!1,error:function(){o.addClass("hidden"),$.toast({text:"loading error!",icon:"error"})},success:function(e){o.addClass("hidden"),$.each(e.images,function(e,a){t.thumbnail;i.find("img").attr("src","/files/uploads/"+a),r+=i[0].outerHTML}),n.prepend(r),""!=e.error&&$.toast({text:e.error,icon:"error"})}})}o?((e=a).ondragover=function(){return!1},e.ondragend=function(){return!1},e.ondrop=function(e){e.preventDefault(),i(e.dataTransfer.files)}):$.toast({text:"Drag and Drop not supported!",icon:"error"}),$(t.btn+" :file").on("change",function(){i(this.files)}),$(document).on("click",".editor-image-delete",function(){var e=$(this).siblings("img").attr("src").split("/");$.post("/admin/summernote/ajax",{action:"images-delete",name:e[e.length-1]},function(e){"ok"==e?$.toast({text:"Image deleted!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"})}),$(this).closest(".editor-images-preview .col-sm-4").remove()})}function imagesSerialize(){var e=[];return $(".images-preview").find("img").each(function(){var t=this.src.split("/");e.push(t[t.length-1])}),escapeJSON(JSON.stringify(e))}function imagesSliderHandler(){$(".slider-images-preview").sortable(),imageUpload("/admin/images/ajax","multiple-upload",{progress:".slider-progress-images",preview:".slider-images-preview",template:".slider-image-item-html .col-md-6",thumbnail:!0,drag:"slider-drag-zone",btn:".slider-btn-images-upload"}),$(document).on("click",".slider-image-delete",function(){var e=$(this).siblings("img").attr("src").split("/");$.post("/admin/images/ajax",{action:"delete",name:e[e.length-1]},function(e){"ok"==e?$.toast({text:"Image deleted!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"})}),$(this).closest(".slider-images-preview .col-md-6").remove()}),$(document).on("click",".slider-image-replace",function(){var e=$(this).siblings("img"),t=$(this).siblings(".slid-file");t.click(),t.change(function(){var t=new FormData;t.append("action","multiple-upload"),t.append("images[]",this.files[0]),$.ajax({url:"/admin/images/ajax",type:"post",data:t,dataType:"json",processData:!1,contentType:!1,success:function(t){if(""!=t.error)$.toast({text:t.error,icon:"error"});else{var a=e.attr("src").split("/");e.attr("src","/files/images/thumbnail/"+t.images[0]),$.post("/admin/images/ajax",{action:"delete",name:a[a.length-1]})}}})})})}function imagesSliderSerialize(){var e=[];return $(".slider-images-preview .col-md-6").each(function(){var t=$(this).find("img").attr("src").split("/");e.push({image:t[t.length-1],button:$(this).find(".slid-button").val(),title:$(this).find(".slid-title").val(),text:$(this).find(".slid-text").val(),url:$(this).find(".slid-url").val()})}),escapeJSON(JSON.stringify(e))}function imagesGalleryHandler(){$(".gallery-images-preview").sortable(),imageUpload("/admin/images/ajax","multiple-upload",{progress:".gallery-progress-images",preview:".gallery-images-preview",template:".gallery-image-item-html .col-md-6",thumbnail:!0,drag:"gallery-drag-zone",btn:".gallery-btn-images-upload"}),$(document).on("click",".gallery-image-delete",function(){var e=$(this).siblings("img").attr("src").split("/");$.post("/admin/images/ajax",{action:"delete",name:e[e.length-1]},function(e){"ok"==e?$.toast({text:"Image deleted!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"})}),$(this).closest(".gallery-images-preview .col-md-6").remove()}),$(document).on("click",".gallery-image-replace",function(){var e=$(this).siblings("img"),t=$(this).siblings(".image-file");t.click(),t.change(function(){var t=new FormData;t.append("action","multiple-upload"),t.append("images[]",this.files[0]),$.ajax({url:"/admin/images/ajax",type:"post",data:t,dataType:"json",processData:!1,contentType:!1,success:function(t){if(""!=t.error)$.toast({text:t.error,icon:"error"});else{var a=e.attr("src").split("/");e.attr("src","/files/images/thumbnail/"+t.images[0]),$.post("/admin/images/ajax",{action:"delete",name:a[a.length-1]})}}})})})}function imagesGallerySerialize(){var e=[];return $(".gallery-images-preview .col-md-6").each(function(){var t=$(this).find("img").attr("src").split("/");e.push({image:t[t.length-1],title:$(this).find(".image-title").val(),text:$(this).find(".image-text").val()})}),escapeJSON(JSON.stringify(e))}function getVideoEmbedHTML(e){var t,a=e.match(/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/),o=e.match(/\/\/instagram.com\/p\/(.[a-zA-Z0-9_-]*)/),i=e.match(/\/\/vine.co\/v\/(.[a-zA-Z0-9]*)/),n=e.match(/\/\/(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/),r=e.match(/.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/),s=e.match(/\/\/v\.youku\.com\/v_show\/id_(\w+)=*\.html/),l=e.match(/^.+.(mp4|m4v)$/),c=e.match(/^.+.(ogg|ogv)$/),d=e.match(/^.+.(webm)$/);if(a&&11===a[1].length){var m=a[1];t=$("<iframe>").attr("frameborder",0).attr("src","//www.youtube.com/embed/"+m).attr("width","640").attr("height","360")}else if(o&&o[0].length)t=$("<iframe>").attr("frameborder",0).attr("src",o[0]+"/embed/").attr("width","612").attr("height","710").attr("scrolling","no").attr("allowtransparency","true");else if(i&&i[0].length)t=$("<iframe>").attr("frameborder",0).attr("src",i[0]+"/embed/simple").attr("width","600").attr("height","600").attr("class","vine-embed");else if(n&&n[3].length)t=$("<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>").attr("frameborder",0).attr("src","//player.vimeo.com/video/"+n[3]).attr("width","640").attr("height","360");else if(r&&r[2].length)t=$("<iframe>").attr("frameborder",0).attr("src","//www.dailymotion.com/embed/video/"+r[2]).attr("width","640").attr("height","360");else if(s&&s[1].length)t=$("<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>").attr("frameborder",0).attr("height","498").attr("width","510").attr("src","//player.youku.com/embed/"+s[1]);else{if(!(l||c||d))return!1;t=$("<video controls>").attr("src",e).attr("width","640").attr("height","360")}return t.addClass("note-video-clip embed-responsive-item"),t[0]}function videoHandler(){var e=$(".video-url-btn"),t=$(".video-url-input"),a=$(".video-item-html"),o=$(".video-preview");o.sortable(),e.click(function(){var e=getVideoEmbedHTML(t.val());console.dir(e),e&&(a.find(".embed-html").html(e),o.prepend(a.html())),t.val("")}),$(document).on("click",".video-delete",function(){$(this).closest(".video-preview .col-md-6").remove()})}function videoSerialize(){var e=[];return $(".video-preview").find(".embed-html").each(function(){e.push($(this).html().trim())}),escapeJSON(JSON.stringify(e))}function escapeJSON(e){return e.replace(/\\n/g,"\\n").replace(/[\\]/g,"\\\\").replace(/[\/]/g,"\\/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")}function updateOuter(){$("#content-wrapper").load(document.location.href+" #content-row",function(){init()})}function editorCodeFormat(e){function t(e){var t="",a=4*e;if(e<0)throw"Level is below 0";for(;a--;)t+=" ";return t}return function(e){for(var a="",o=0,i=(e=e.trim()).split(/</),n=0,r=i.length;n<r;n++){var s=i[n].split(/>/);2===s.length?("/"===i[n][0]&&o--,a+=t(o),"/"!==i[n][0]&&o++,n>0&&(a+="<"),a+=s[0].trim()+">\n",""!==s[1].trim()&&(a+=t(o)+s[1].trim().replace(/\s+/g," ")+"\n"),s[0].match(/^(img|hr|br)/)&&o--):a+=t(o)+s[0]+"\n"}return a}(e)}function editorInit(){$.getScript("/admin/public/js/summernote.min.js",function(){$(".editor-content").each(function(e,t){$(t).summernote({toolbar:[["font",["bold","underline","strikethrough","clear"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link","image","video","components"]],["height",["height"]],["view",["fullscreen","aceeditor"]]],buttons:{image:function(){return $.summernote.ui.button({contents:'<i class="fa fa-image" />',tooltip:"Image manager",click:function(){$.post("/admin/summernote/ajax",{action:"get-filemanager-html"},function(e){bootbox.dialog({title:"Image manager",message:e,className:"big-modal"}).on("hidden.bs.modal",function(){$(document).off("click",".editor-image-delete"),$(document).off("click",".editor-image-insert"),$("body").addClass("modal-open")}),summernoteImageHandler(),$(document).on("click",".editor-image-insert",function(){var e=$(this).siblings("img").clone();$(t).summernote("insertNode",e[0])})})}}).render()},aceeditor:function(){return $.summernote.ui.button({contents:'<i class="fa fa-code" />',tooltip:"Source",click:function(){$.post("/admin/summernote/ajax",{action:"get-editor-html"},function(e){bootbox.dialog({title:"Html code editing",message:e,className:"big-modal"}).on("hidden.bs.modal",function(){$("body").addClass("modal-open")});var a=editorCodeFormat($(t).val(),"header");$(t).summernote("code",a),$(t).val(a);var o=ace.edit("editor");o.session.setMode("ace/mode/php"),o.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!1,minLines:10,maxLines:1/0}),o.setValue($(t).val(),1),o.on("input",function(){$(t).summernote("code",o.getValue()),$(t).val(o.getValue())})})}}).render()},components:function(){return $.summernote.ui.button({contents:'<i class="fa fa-cubes" />',tooltip:"Component gallery",click:function(){$.post("/admin/summernote/ajax",{action:"get-components-html"},function(e){bootbox.dialog({title:"Component gallery",message:e,className:"big-modal"}).on("hidden.bs.modal",function(){$("body").addClass("modal-open")}),$(".insert-component").click(function(){var e=$(this).clone();e.removeClass("insert-component"),$(t).summernote("insertNode",e[0])})})}}).render()}},callbacks:{onChange:function(){$(t).data("bv-field")&&$(t).closest("form").data("bootstrapValidator").updateStatus($(t).attr("name"),"NOT_VALIDATED",null).validateField($(t).attr("name"))}},height:400})})})}function navigationHandler(){var e=$(".panel-content").data("root-nav");$(".sidebar-menu li.side-nav-item").filter(function(){return $(this).data("item")==e}).addClass("active menu-open")}function navbarHandler(){$.post("/admin/navbar/ajax",{action:"get-data"},function(e){e=JSON.parse(e);var t=$(".actions-navbar-container"),a=$(".messages-navbar-container");e.formdata>0?$(".formdata-count-label").text(e.formdata).removeClass("hidden"):$(".formdata-count-label").text("").addClass("hidden"),e.actions.count>0?(t.empty(),$.each(e.actions.logs,function(e,a){var o=$(".actions-navbar-template").clone();o.find(".actions-navbar-login").text(a.login),o.find(".actions-navbar-message").text(a.event),t.prepend(o.removeClass("actions-navbar-template hidden"))}),t.removeClass("hidden")):t.addClass("hidden"),e.messages.count>0?(a.empty(),$.each(e.messages.messages,function(e,t){var o=$(".messages-navbar-template").clone();o.find(".messages-navbar-header").text(t.subject),o.find(".messages-navbar-time").text(t.time),o.find(".messages-navbar-login").text(t["user-data"].login),o.find(".messages-navbar-link").attr("href","/admin/messages/one/"+t.id),a.prepend(o.removeClass("messages-navbar-template hidden"))}),$(".messages-count-label").text(e.messages.count).removeClass("hidden"),a.removeClass("hidden")):($(".messages-count-label").text("").addClass("hidden"),a.addClass("hidden")),getLocalStorage("last-new-formdata-count")<e.formdata&&audioNotifyPlay(),getLocalStorage("last-new-messages-count")<e.messages.count&&audioNotifyPlay(),setLocalStorage("last-new-formdata-count",e.formdata),setLocalStorage("last-new-messages-count",e.messages.count)})}function loginHandler(){$.ajax({url:"/admin/check-login",dataType:"text",success:function(e,t){"ok"!==e&&location.reload()},error:function(){location.reload()}})}function sparkbar(){$(".sparkbar").each(function(){var e=$(this);e.sparkline("html",{type:"bar",height:e.data("height")?e.data("height"):"30",barColor:e.data("color")})}),$(".sparkpie").each(function(){var e=$(this);e.sparkline("html",{type:"pie",height:e.data("height")?e.data("height"):"90",sliceColors:e.data("color")})}),$(".sparkline").each(function(){var e=$(this);e.sparkline("html",{type:"line",height:e.data("height")?e.data("height"):"90",width:"100%",lineColor:e.data("linecolor"),fillColor:e.data("fillcolor"),spotColor:e.data("spotcolor")})})}function layoutPanelHandler(){$('[data-toggle="control-sidebar"]').controlSidebar(),$('[data-toggle="push-menu"]').pushMenu();var e=$("body"),t=$('[data-toggle="push-menu"]').data("lte.pushmenu"),a=$('[data-toggle="control-sidebar"]').data("lte.controlsidebar");"collapse"==getLocalStorage("push-menu-status")&&$("body").addClass("sidebar-collapse"),$(".sidebar-toggle").click(function(){$("body").hasClass("sidebar-collapse")?setLocalStorage("push-menu-status","not-collapse"):setLocalStorage("push-menu-status","collapse")});var o=["skin-blue","skin-black","skin-red","skin-yellow","skin-purple","skin-green","skin-blue-light","skin-black-light","skin-red-light","skin-yellow-light","skin-purple-light","skin-green-light"];function i(o){e.toggleClass(o),e.hasClass("fixed")&&"fixed"==o&&t.expandOnHover(),a.fix()}function n(t){return $.each(o,function(t){e.removeClass(o[t])}),e.addClass(t),setLocalStorage("skin",t),!1}var r=getLocalStorage("skin");r&&$.inArray(r,o)&&n(r),$("[data-skin]").on("click",function(e){$(this).hasClass("knob")||(e.preventDefault(),n($(this).data("skin")))}),$("[data-layout]").on("click",function(){i($(this).data("layout"))}),$("[data-controlsidebar]").on("click",function(){i($(this).data("controlsidebar"));var e=!a.options.slide;a.options.slide=e,e||$(".control-sidebar").removeClass("control-sidebar-open")}),$('[data-sidebarskin="toggle"]').on("click",function(){var e=$(".control-sidebar");e.hasClass("control-sidebar-dark")?(e.removeClass("control-sidebar-dark"),e.addClass("control-sidebar-light")):(e.removeClass("control-sidebar-light"),e.addClass("control-sidebar-dark"))}),$('[data-enable="expandOnHover"]').on("click",function(){$(this).attr("disabled",!0),t.expandOnHover(),$("body").hasClass("sidebar-collapse")||$('[data-layout="sidebar-collapse"]').click()}),e.hasClass("fixed")&&$('[data-layout="fixed"]').attr("checked","checked"),e.hasClass("layout-boxed")&&$('[data-layout="layout-boxed"]').attr("checked","checked"),e.hasClass("sidebar-collapse")&&$('[data-layout="sidebar-collapse"]').attr("checked","checked")}function audioNotifyPlay(){$("#notify-audio")[0].play()}function chatNotifyPlay(){$("#chat-audio")[0].play()}sparkbar();