function subscriptionsActionHandler(){document.location.href.indexOf("subscriptions")<0||(subscriptionsBtnHelper(),$(".new-subscriptions").on("click",function(){subscriptionsNew()}),$(".btn-subscriptions-checkbox").on("click",function(){subscriptionsCheckboxHandler()}),$(".subscription-action div").on("click",function(){var t=$(this).closest("tr.subscriptions-list").attr("id").split("-")[1];switch($(this).attr("class")){case"subscription-update-status-on":subscriptionUpdateStatus(t,0);break;case"subscription-update-status-off":subscriptionUpdateStatus(t,1);break;case"subscription-delete":subscriptionDelete(t)}}),subscriptionsTableSortable())}function subscriptionsTableSortable(){var t=[];$(".table-subscriptions-body").sortable({appendTo:"parent",handle:".fa-bars",start:function(s,e){$(this).children().each(function(){$(this).hasClass("ui-sortable-placeholder")||t.push($(this).attr("id").split("-")[2])})},update:function(s,e){var a=[],n=[];$(this).children().each(function(){$(this).hasClass("ui-sortable-placeholder")||a.push($(this).attr("id").split("-")[1])}),$.each(a,function(s,e){n.push({id:[e],position:t[s]})}),n=JSON.stringify(n),$.post("/admin/subscriptions/ajax",{action:"update-position",json:n},function(t){"ok"==t?$.toast({text:"Change saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"})})}}).disableSelection()}function subscriptionsBtnHelper(){$("table tr.success").length<1&&$(".new-subscriptions").addClass("disabled").removeClass("new-delivery")}function subscriptionsNew(){$.post("/admin/subscriptions/ajax",{action:"get-form-new"},function(t){bootbox.dialog({title:"New newsletter",message:t,className:"big-modal",buttons:{success:{label:"Send out",className:"btn-success",callback:function(){return $("#subscription-form-new").submit(),!1}},danger:{label:"Cancel",className:"btn-danger",callback:function(){}}}}),editorInit(),$("#subscription-form-new").bootstrapValidator({excluded:[":disabled"],fields:{title:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"}}},content:{validators:{notEmpty:{message:"Cannot be empty."}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var s=$.param({action:"delivery"});$.post("/admin/subscriptions/ajax",$(t.target).serialize()+"&"+s,function(t){"ok"==t?(bootbox.hideAll(),$.toast({text:"Newsletter completed!",icon:"success"})):$.toast({text:"An error has occurred!",icon:"error"})})})})}function subscriptionUpdateStatus(t,s){var e="";e=1==s?"Make email active?":"Make email inactive?",bootbox.dialog({message:e,buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/subscriptions/ajax",{action:"update",status:s,"id[]":t},function(t){"ok"==t?$.toast({text:"Changes saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}})}function subscriptionsCheckboxHandler(){var t=$("#list-subscriptions-form").serialize();t.indexOf("select-action=enable")+1?t+="&action=update&status=1":t.indexOf("select-action=disable")+1?t+="&action=update&status=0":t.indexOf("select-action=delete")+1&&(t+="&action=delete"),t.indexOf("id")+1?bootbox.dialog({message:"Perform selected action?",buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/subscriptions/ajax",t,function(t){"ok"==t?$.toast({text:"Changes saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}}):bootbox.alert("You have not chosen anything!")}function subscriptionDelete(t){bootbox.dialog({message:"Remove email from the mailing list?",buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/subscriptions/ajax",{action:"delete","id[]":t},function(t){"ok"==t?$.toast({text:"Email deleted!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}})}