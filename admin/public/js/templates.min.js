function templatesActionHandler(){document.location.href.indexOf("templates")<0||(document.location.href.indexOf("edit")>0&&function(){var t=$("#template").val(),e=$("#patch").val(),a=$(".editor-info"),n=$(".btn-save"),o=ace.edit("editor-area");o.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!1,minLines:10,maxLines:1/0}),o.setValue("",1),a.text(a.text()+" не выбран"),n.prop("disabled",!0),$(".editor-file-list").fileTree({root:e,script:"/admin/templates/get-list",folderEvent:"click",multiFolder:!1},function(i){e=i,n.prop("disabled",!1),o.session.setMode("ace/mode/"+function(t){var e=t.split(".");switch(e[e.length-1]){case"tpl":return"php";case"css":return"css";case"js":return"javascript"}}(i)),o.setValue(function(t){var e;return $.ajax({type:"POST",async:!1,data:{file:t,action:"get-content"},url:"/admin/templates/ajax",success:function(t){e=t}}),e}(e),1),a.text("Template editing: "+t+" file: "+e.split(t+"/")[1])}),n.on("click",function(){$.post("/admin/templates/ajax",{action:"save",file:e,content:o.getValue()},function(t){"ok"==t?$.toast({text:"Changes saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"})})})}(),$("#templates-form").bootstrapValidator().on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var e=$.param({action:"set-template",id:[id]});$.post("/admin/templates/ajax",$(t.target).serialize()+"&"+e,function(t){"ok"==t?$.toast({text:"Template changed!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}),$("#edit-template").change(function(){$.post("/admin/templates/ajax",{"edit-template":this.value,action:"set-edit-template"},function(t){"ok"!=t&&$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}))}