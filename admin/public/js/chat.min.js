function chatActionHandler(){chatSendMessageHandler()}function chatUpdate(t){var a=$(".chat-message-container"),e=a.data("user"),s=a.data("last");function n(t){$(".chat-count-badge").text(t.count),$.each(t.messages,function(){var t=$(".chat-message-template").clone();this.user==e&&t.addClass("right"),t.removeClass("hidden chat-message-template"),t.find(".direct-chat-name").text(this.name),t.find(".direct-chat-text").text(this.message),t.find(".direct-chat-timestamp").text(this.time),a.append(t)}),a.animate({scrollTop:a[0].scrollHeight},2e3),a.data("last",t.last),setLocalStorage("chat-last-id",t.last)}setLocalStorage("chat-last-id",s),"object"!=typeof t?$.post("/admin/chat/ajax",{action:"get-last"},function(t){s<t&&$.post("/admin/chat/ajax",{action:"get-message",last:s},function(t){"object"==typeof t&&(n(t),chatNotifyPlay())})}):n(t)}function chatSendMessageHandler(){$("#chat-send-form").bootstrapValidator({fields:{message:{validators:{notEmpty:{message:"Cannot be empty."}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var a=$.param({action:"send-message",last:getLocalStorage("chat-last-id")});$.post("/admin/chat/ajax",$(t.target).serialize()+"&"+a,function(t){"object"==typeof t&&chatUpdate(t),$(".chat-send-input").val("")})})}