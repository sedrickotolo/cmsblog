function usersActionHandler(){document.location.href.indexOf("users")<0||($(".users-list").ntm(),$(".user-add").on("click",function(){userAdd()}),$(".log-clear").on("click",function(){clearLog()}),$(".btn-users-checkbox").on("click",function(){usersCheckboxHandler()}),$(".user-action div").on("click",function(){var e=$(this).closest(".users-list").attr("id").split("-")[1];switch($(this).attr("class")){case"user-edit":userEdit(e);break;case"user-update-role-admin":userUpdateRole(e,0);break;case"user-update-role-user":userUpdateRole(e,1);break;case"user-update-role-manager":userUpdateRole(e,2);break;case"user-update-role-trade":userUpdateRole(e,3);break;case"user-update-status-on":userUpdateStatus(e,0);break;case"user-update-status-off":userUpdateStatus(e,1);break;case"user-delete":userDelete(e)}}))}function clearLog(){bootbox.dialog({message:"Clear user action log?",buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/users/ajax",{action:"clear-log"},function(e){"ok"==e?$.toast({text:"The log is cleared!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}})}function usersCheckboxHandler(){var e=$("#list-users-form").serialize();e.indexOf("select-action=admin")+1?e+="&action=update&role=0":e.indexOf("select-action=user")+1?e+="&action=update&role=1":e.indexOf("select-action=manager")+1?e+="&action=update&role=2":e.indexOf("select-action=trade")+1?e+="&action=update&role=3":e.indexOf("select-action=delete")+1&&(e+="&action=delete"),e.indexOf("id")+1?bootbox.dialog({message:"Perform selected action?",buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/users/ajax",e,function(e){"ok"==e?$.toast({text:"Changes saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}}):bootbox.alert("You have not chosen anything!")}function userAdd(){$.post("/admin/users/ajax",{action:"get-form-add"},function(e){bootbox.dialog({title:"Add new user",message:e,className:"big-modal",buttons:{success:{label:"Save",className:"btn-success",callback:function(){return $("#user-form-add").submit(),!1}},danger:{label:"Cancel",className:"btn-danger",callback:function(){}}}}),$(".selectpicker").selectpicker({container:".big-modal",iconBase:"fa",tickIcon:"fa-check-square-o"}),$(".check-box-picker").checkboxpicker(),$("#user-form-add").bootstrapValidator({excluded:[":disabled"],fields:{login:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"},remote:{message:"This login is already in use",data:{action:"check-free-login"},url:"/admin/users/ajax",type:"POST",delay:0}}},name:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"}}},email:{validators:{notEmpty:{message:"Cannot be empty."},emailAddress:{message:"Please enter a valid email address."},remote:{message:"This email is already in use",data:{action:"check-free-email"},url:"/admin/users/ajax",type:"POST",delay:0}}},password:{validators:{notEmpty:{message:"Cannot be empty."},identical:{field:"password",message:"Password mismatch"},stringLength:{min:6,message:"6 characters minimum"}}}}}).on("success.form.bv",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var a=$.param({action:"add"});$.post("/admin/users/ajax",$(e.target).serialize()+"&"+a,function(e){"ok"==e?(bootbox.hideAll(),$.toast({text:"User added!",icon:"success"})):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})})})}function userEdit(e){$.post("/admin/users/ajax",{action:"get-form-edit",id:e},function(a){bootbox.dialog({title:"User editing",message:a,className:"big-modal",buttons:{success:{label:"Save",className:"btn-success",callback:function(){return $("#user-form-edit").submit(),!1}},danger:{label:"Cancel",className:"btn-danger",callback:function(){}}}}),$(".selectpicker").selectpicker({container:".big-modal",iconBase:"fa",tickIcon:"fa-check-square-o"}),$(".check-box-picker").checkboxpicker(),$("#user-form-edit").bootstrapValidator({excluded:[":disabled"],fields:{login:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"},remote:{message:"This login is already in use",data:{action:"check-free-login",id:e},url:"/admin/users/ajax",type:"POST",delay:0}}},name:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"}}},email:{validators:{notEmpty:{message:"Cannot be empty."},emailAddress:{message:"Please enter a valid email address."},remote:{message:"This email is already in use",data:{action:"check-free-email",id:e},url:"/admin/users/ajax",type:"POST",delay:0}}},password:{validators:{identical:{field:"password",message:"Password mismatch"},stringLength:{min:6,message:"6 characters minimum"}}},"super-password":{validators:{notEmpty:{message:"Cannot be empty."},remote:{message:"Incorrect password",data:{action:"check-super-password"},url:"/admin/users/ajax",type:"POST",delay:0}}}}}).on("success.form.bv",function(a){a.preventDefault?a.preventDefault():a.returnValue=!1;var s=$.param({action:"update",id:[e]});$.post("/admin/users/ajax",$(a.target).serialize()+"&"+s,function(e){"ok"==e?(bootbox.hideAll(),$.toast({text:"Changes saved!",icon:"success"})):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})})})}function userUpdateRole(e,a){var s="";0==a?s="Make administrator?":1==a&&(s="Make visitor?"),bootbox.dialog({message:s,buttons:{success:{label:"yes",className:"btn-success",callback:function(){$.post("/admin/users/ajax",{action:"update",role:a,"id[]":e},function(e){"ok"==e?$.toast({text:"Changes saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}})}function userDelete(e){bootbox.dialog({message:"Delete user?",buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/users/ajax",{action:"delete","id[]":e},function(e){"ok"==e?$.toast({text:"User deleted!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}})}function userUpdateStatus(e,a){var s="";s=1==a?"Enable user?":"Disconnect user?",bootbox.dialog({message:s,buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/users/ajax",{action:"update",status:a,"id[]":e},function(e){"ok"==e?$.toast({text:"Changes saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}})}