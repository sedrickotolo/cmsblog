function categoryActionHandler(){document.location.href.indexOf("category")<0||(categoryListInit(),categorySearchInit(),$(".category-add").on("click",function(){categoryAdd()}),$(".category-action button").on("click",function(){switch($(this).attr("class")){case"btn btn-sm category-descendant":categoryAdd(categoryGetSelected()[0]);break;case"btn btn-sm category-edit":categoryEdit(categoryGetSelected()[0]);break;case"btn btn-sm category-enable":categoryUpdateStatus(1);break;case"btn btn-sm category-disable":categoryUpdateStatus(0);break;case"btn btn-sm category-delete":categoryDelete()}}))}function categorySearchInit(){$(".category-search").keyup(function(){$(".category-tree-list").jstree(!0).search($(this).val())})}function categoryActionBtnHelper(e){function t(t){if("deselect_all"==e.action)return!0;var a=!0,c=e.selected.length;switch(t){case"category-descendant":case"category-edit":1==c&&(a=!1);break;case"category-enable":case"category-disable":case"category-delete":c>0&&(a=!1)}return a}$(".category-descendant").prop("disabled",t("category-descendant")),$(".category-edit").prop("disabled",t("category-edit")),$(".category-enable").prop("disabled",t("category-enable")),$(".category-disable").prop("disabled",t("category-disable")),$(".category-delete").prop("disabled",t("category-delete"))}function categoryListViewHelper(e){$.each(e.instance._model.data,function(e,t){"#"!=t.id&&0==t.original.status&&$("#"+t.id+"_anchor").addClass("js-tree-disabled-node")})}function categoryViews(){$(".category-tree-list .jstree-node").length?($(".category-search").closest(".well").removeClass("hidden"),$(".category-not-found").addClass("hidden"),$(".category-action").removeClass("hidden")):($(".category-search").closest(".well").addClass("hidden"),$(".category-not-found").removeClass("hidden"),$(".category-action").addClass("hidden"))}function categoryListInit(){$(".category-tree-list").jstree({core:{animation:1,check_callback:!0,force_text:!0,themes:{name:"default",responsive:!0,stripes:!0},data:{url:"/admin/category/get-json",dataType:"json"}},types:{default:{icon:"glyphicon glyphicon-eye-open"},disabled:{icon:"glyphicon glyphicon-eye-close"}},checkbox:{three_state:!1},plugins:["dnd","search","wholerow","checkbox","types"]}).on("changed.jstree",function(e,t){categoryActionBtnHelper(t)}).on("move_node.jstree",function(e,t){var a=0,c=[];!function e(t){$.each(t,function(t,o){c.push({id:[o.id],position:a}),a++,o.children.length>0&&e(o.children)})}(t.new_instance.get_json()),$.post("/admin/category/ajax",{action:"update-position","new-position":JSON.stringify(c),parent:"#"==t.parent?0:t.parent,"id[]":t.node.id},function(e){"ok"==e&&($.toast({text:"Changes saved!",icon:"success"}),$(".category-tree-list").jstree("refresh"))})}).on("ready.jstree",function(e,t){categoryViews(),categoryListViewHelper(t)}).on("open_node.jstree",function(e,t){categoryListViewHelper(t)}).on("refresh.jstree",function(e,t){categoryViews(),categoryListViewHelper(t)})}function categoryGetSelected(e){var t=$(".category-tree-list").jstree(!0),a=t.get_selected(),c=t.get_selected(!0);return!0===e&&$.each(c,function(e,t){$.each(t.children_d,function(e,t){a.push(t)})}),a.length?a:0}function categoryElementsSerialize(){var e={previews:$('input:radio[name="preview-element"]:checked').val(),elements:[],property:{}};return $(".element-item").each(function(){e.elements.push($(this).data("element"))}),$(".element-property-item").each(function(){e.property[$(this).attr("id")]=$(this).is(":checked")?1:0}),JSON.stringify(e)}function categoryAdd(e){$.post("/admin/category/ajax",{action:"get-form-add",parent:void 0===e?"0":e},function(e){bootbox.dialog({title:"Adding a new category",message:e,className:"big-modal",buttons:{success:{label:"Save",className:"btn-success",callback:function(){return $("#category-form-add").submit(),!1}},danger:{label:"Cancel",className:"btn-danger",callback:function(){}}}}).on("hidden.bs.modal",function(){$(document).off("click",".slider-image-replace"),$(document).off("click",".slider-image-delete"),$(document).off("click",".image-delete")}),editorInit(),imagesHandler(),imagesSliderHandler(),$(".icp-auto").iconpicker(),$(".selectpicker").selectpicker({container:".big-modal",iconBase:"fa",tickIcon:"fa-check-square-o"}),$(".elements-list").sortable(),$(".token-field").tokenfield(),$(".check-box-picker").checkboxpicker(),$(".translit-in").on("input",function(){$(this).liTranslit({elAlias:$(".translit-out")})}),$(".input-in").change(function(){$(".input-out").val($(this).val())}),$("#category-form-add").bootstrapValidator({excluded:[":disabled"],fields:{url:{validators:{notEmpty:{message:"Cannot be empty."},remote:{message:"This URL is already in use.",data:{action:"check-free-url"},url:"/admin/category/ajax",type:"POST",delay:0}}},name:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"}}},title:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"}}},header:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"}}},description:{validators:{stringLength:{max:160,message:"255 characters maximum"}}}}}).on("success.form.bv",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var t=$.param({elements:categoryElementsSerialize(),slider:imagesSliderSerialize(),images:imagesSerialize(),action:"add"});$.post("/admin/category/ajax",$(e.target).serialize()+"&"+t,function(e){"ok"==e?(bootbox.hideAll(),$.toast({text:"Category added!",icon:"success"})):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})})})}function categoryEdit(e){$.post("/admin/category/ajax",{action:"get-form-edit",id:e},function(t){bootbox.dialog({title:"Category editing",message:t,className:"big-modal",buttons:{success:{label:"Save",className:"btn-success",callback:function(){return $("#category-form-edit").submit(),!1}},danger:{label:"Cancel",className:"btn-danger",callback:function(){}}}}).on("hidden.bs.modal",function(){$(document).off("click",".slider-image-replace"),$(document).off("click",".slider-image-delete"),$(document).off("click",".image-delete")}),editorInit(),imagesHandler(),imagesSliderHandler(),$(".icp-auto").iconpicker(),$(".selectpicker").selectpicker({container:".big-modal",iconBase:"fa",tickIcon:"fa-check-square-o"}),$(".elements-list").sortable(),$(".token-field").tokenfield(),$(".check-box-picker").checkboxpicker(),$(".translit-in").on("input",function(){$(this).liTranslit({elAlias:$(".translit-out")})}),$(".input-in").change(function(){$(".input-out").val($(this).val())}),$("#category-form-edit").bootstrapValidator({excluded:[":disabled"],fields:{url:{validators:{notEmpty:{message:"Cannot be empty."},remote:{message:"This URL is already in use.",data:{action:"check-free-url",id:e},url:"/admin/category/ajax",type:"POST",delay:0}}},name:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"}}},title:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"}}},header:{validators:{notEmpty:{message:"Cannot be empty."},stringLength:{max:255,message:"255 characters maximum"}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var a=$.param({elements:categoryElementsSerialize(),slider:imagesSliderSerialize(),images:imagesSerialize(),action:"update",id:[e]});$.post("/admin/category/ajax",$(t.target).serialize()+"&"+a,function(e){"ok"==e?(bootbox.hideAll(),$.toast({text:"Changes saved!",icon:"success"})):$.toast({text:"An error has occurred!",icon:"error"}),updateOuter()})})})}function categoryUpdateStatus(e){var t="";t=1==e?"Activate selected categories?":"Deactivate selected categories?",bootbox.dialog({message:t,buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/category/ajax",{action:"update",status:e,id:categoryGetSelected(!0)},function(e){"ok"==e?$.toast({text:"Changes saved!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),$(".category-tree-list").jstree("refresh")})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}})}function categoryDelete(){bootbox.dialog({message:"Delete selected categories? <br> Child categories move up one level!",buttons:{success:{label:"Yes",className:"btn-success",callback:function(){$.post("/admin/category/ajax",{action:"delete",id:categoryGetSelected()},function(e){"ok"==e?$.toast({text:"Categories removed!",icon:"success"}):$.toast({text:"An error has occurred!",icon:"error"}),$(".category-tree-list").jstree("refresh")})}},danger:{label:"No",className:"btn-danger",callback:function(){}}}})}